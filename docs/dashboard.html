<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Shop Status Board</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css">
<style>
  .container{max-width:1100px;margin:0 auto}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
  @media (max-width:900px){.grid{grid-template-columns:1fr}}
  .col{border:1px solid #e5e7eb;border-radius:12px;padding:12px;background:#fff}
  .hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
  .pill{border:1px solid #e5e7eb;border-radius:999px;padding:2px 8px;font-size:.85rem}
  .card{border:1px solid #eef2f7;border-radius:10px;padding:10px;margin:8px 0;background:#fafafa}
  .name{font-weight:600}
  .muted{opacity:.7}
  .tools{display:flex;gap:8px;align-items:center;margin:8px 0 16px}
  input[type="search"]{width:260px}
</style>
</head>
<body>
<div class="container">
  <h2>Shop Status Board</h2>
  <div class="tools">
    <input id="q" type="search" placeholder="Search name / plate / vehicle">
    <button id="refresh">Refresh</button>
    <span id="updated" class="muted"></span>
  </div>

  <div class="grid" id="grid"></div>
</div>

<script>
const WEBAPP = "YOUR_APPS_SCRIPT_WEB_APP_URL";
const COLUMNS = ["Arrived","Waiting","Shuttle","In Service","Ready for Pickup","Picked Up"];

function groupRows(rows){
  const g = {}; COLUMNS.forEach(k=>g[k]=[]);
  for(const r of rows){
    const st = (r.status||'').trim();
    if(!g[st]) g[st]=[];
    g[st].push(r);
  }
  return g;
}

function render(groups){
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  for(const col of COLUMNS){
    const arr = groups[col]||[];
    const count = arr.length;
    const div = document.createElement('div'); div.className='col';
    div.innerHTML = `<div class="hdr"><h3>${col}</h3><span class="pill">${count}</span></div>` +
      (count? arr.map(r => `<div class="card">
        <div class="name">${r.customer_name||'—'}</div>
        <div class="muted">${r.vehicle||''} ${r.plate||''}</div>
        <div class="muted">${r.visit_type||''} • ${new Date(r.timestamp).toLocaleString()}</div>
      </div>`).join('') : `<div class="muted">No entries</div>`);
    grid.appendChild(div);
  }
}

async function load(){
  const res = await fetch(WEBAPP + '?action=list&maxRows=400');
  const j = await res.json();
  let rows = j.ok ? j.rows : [];
  const q = document.getElementById('q').value.toLowerCase().trim();
  if(q){
    rows = rows.filter(r => (r.customer_name||'').toLowerCase().includes(q) ||
                            (r.vehicle||'').toLowerCase().includes(q) ||
                            (r.plate||'').toLowerCase().includes(q));
  }
  render(groupRows(rows));
  document.getElementById('updated').textContent = 'Updated ' + new Date().toLocaleTimeString();
}

document.getElementById('refresh').addEventListener('click', load);
document.getElementById('q').addEventListener('input', () => { load(); });
load(); setInterval(load, 25000);
</script>
</body>
</html>
